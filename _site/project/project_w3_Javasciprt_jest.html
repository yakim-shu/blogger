<!doctype html>
<html>

<head>

  <title>
    
      [第三週] JavaScript - 測試、Jest、TDD | Yakim shu
    
  </title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="畢竟程式碼是照你「寫」的跑、不是照你「想」的跑，所以需要寫測試。">
  <meta name="author" content="Yakim, toromilk80129@gmail.com">
  <meta name="robots" content="INDEX,FOLLOW">
  <!--og-->
  <meta property="og:title" content="[第三週] JavaScript - 測試、Jest、TDD">
  <meta name="og:description" content="畢竟程式碼是照你「寫」的跑、不是照你「想」的跑，所以需要寫測試。">
  <meta property="og:url" content="http://localhost:4000/project/project_w3_Javasciprt_jest.html">

    
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quattrocento+Sans">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77560722-1', 'auto');
  ga('send', 'pageview');

</script>


</head>


<body>

  <div class="container">
    <header class="masthead">
  <h3 class="masthead-title">
    <a href="/">Yakim shu</a>
    <small class="masthead-subtitle">Hi, 這是我擴充腦內海馬體的地方。</small>
    <div class="menu">
  <div class="menu-content">
    <a href="/category.html">分類文章</a>
    <a href="/writing.html">全文列表</a>
    <!-- <a href="/contacts.html">Contact</a> -->
  </div>
  <div class="social-icons">
    <a href="https://www.facebook.com/yakimshu"><i class="fa fa-facebook" aria-hidden="true" target="_blank"></i></a>
    <a href="https://linkedin.com/in/yakimshu"><i class="fa fa-linkedin" aria-hidden="true" target="_blank"></i></a>
    <a href="mailto:toromilk80129@gmail.com"><i class="fa fa-envelope" aria-hidden="true" target="_blank"></i></a>
  </div>
</div>

  </h3>
</header>


    <div class="post-container story">
      <h1>
  [第三週] JavaScript - 測試、Jest、TDD
</h1>



<h2 id="測試的重要性">測試的重要性</h2>

<p>當我們寫好一段程式碼，想知道結果正確與否，應該說<strong>想確認是否為我們預期的結果</strong>。</p>

<p>畢竟<strong>程式碼是照你「寫」的跑、不是照你「想」的跑</strong>，所以需要寫測試，而最簡單的測試方法就是把結果印出來： <code class="highlighter-rouge">console.log()</code>。</p>

<h4 id="最陽春的測試---印出來">最陽春的測試 - 印出來</h4>
<p>假設我要寫一個重複字串的函式 <code class="highlighter-rouge">repeat()</code>，有 <code class="highlighter-rouge">str</code> 跟 <code class="highlighter-rouge">times</code> 兩個參數。 那就看 <code class="highlighter-rouge">log</code> 出來的結果跟我們預期的是否相同。而且最好多放一些<strong>極端情況</strong>的測試資料，例如：</p>
<ul>
  <li><code class="highlighter-rouge">''</code>  ( 空字串 ) 重複 <code class="highlighter-rouge">10</code> 次</li>
  <li><code class="highlighter-rouge">abc</code> 重複 <code class="highlighter-rouge">0</code> 次</li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">repeat</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">times</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">times</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="c1">//abcabcabc</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="c1">// (空字串)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span> <span class="c1">// (空字串)</span>
</code></pre>
</div>

<hr />

<h2 id="jest">Jest</h2>

<p>因為剛剛的測試方法沒辦法自動化、也會將測試檔跟主程式混在一起，當結構越來越大時並不符合使用，所以我們引入 Jest ，這個由 Facebook 開發的 JavaScript 測試框架。</p>

<h3 id="用-jest-改寫剛剛的測試">用 Jest 改寫剛剛的測試</h3>

<ol>
  <li>先用 <code class="highlighter-rouge">npm</code> or <code class="highlighter-rouge">yarn</code> 下載套件：
    <ul>
      <li><code class="highlighter-rouge">npm install jest --save-dev</code></li>
    </ul>
  </li>
  <li>打開 <code class="highlighter-rouge">package.json</code> 可以看到 <code class="highlighter-rouge">jest</code> 已經被記錄在 <code class="highlighter-rouge">devDependencies</code></li>
  <li>修改 <code class="highlighter-rouge">script</code> 的 <code class="highlighter-rouge">test</code> 指令為 <code class="highlighter-rouge">jest</code>：
    <ul>
      <li><code class="highlighter-rouge">"test": "jest"</code></li>
    </ul>
  </li>
  <li>設定好後，只需要在 Terminal 輸入： <code class="highlighter-rouge">npm run test</code></li>
</ol>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">//</span><span class="w"> </span><span class="err">package.json</span><span class="w">
  </span><span class="s2">"scripts"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jest"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">
  </span><span class="s2">"devDependencies"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"jest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^24.7.1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<blockquote>
  <p>注意：</p>
</blockquote>

<p>如果直接在 Terminal 輸入 <code class="highlighter-rouge">jest</code> 指令是不會有反應的喔，因為他是被安裝在專案目錄下，而 Terminal 內的 <code class="highlighter-rouge">jest</code> 指令需要安裝在<strong>全域</strong>下才能運行。</p>

<hr />

<h3 id="開始測試">開始測試</h3>

<p><code class="highlighter-rouge">Jest</code> 進行測試時，<strong>會先找專案中副檔名為 <code class="highlighter-rouge">.test.js</code> 的檔案</strong>，這邊建立一個 <code class="highlighter-rouge">repeat.test.js</code> 來測試剛剛的函式 <code class="highlighter-rouge">repeat()</code>。</p>

<p>所以我們會有兩個檔案：</p>
<ul>
  <li><code class="highlighter-rouge">repeat.js</code> 被測試的檔案 ( Unit, Module, 主程式… )</li>
  <li><code class="highlighter-rouge">repeat.test.js</code> 拿來測試 <code class="highlighter-rouge">repeat.js</code> 的測試檔</li>
</ul>

<h4 id="repeatjs--主程式-or-module">repeat.js （ 主程式 or Module）</h4>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">repeat</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">times</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">times</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">repeat</span><span class="p">;</span>
</code></pre>
</div>

<h4 id="repeattestjs---測試檔-">repeat.test.js  （ 測試檔 ）</h4>
<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">repeat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./repeat'</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s2">"測試 function - repeat()"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">test</span><span class="p">(</span><span class="s1">'"abc" 重複 3 次'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">'abcabcabc'</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">test</span><span class="p">(</span><span class="s1">'&lt;空字串&gt; 重複 10 次'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">''</span><span class="p">,</span> <span class="mi">10</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">test</span><span class="p">(</span><span class="s1">'"abc" 重複 0 次'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">repeat</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">''</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre>
</div>

<h4 id="jest-api-名詞解析">Jest api 名詞解析</h4>

<ul>
  <li>describe
    <ul>
      <li>將相關測試案例整合成一個測試結果，通常拿來描述這些測試是屬於哪個元件或 function。</li>
      <li>( 對照下圖 Test Suites )</li>
    </ul>
  </li>
  <li>test
    <ul>
      <li>定義一個最小的測試案例</li>
      <li>( 對照下圖 Test )</li>
    </ul>
  </li>
  <li>斷言
    <ul>
      <li><strong>expect</strong>: 用來判斷是否和預期值相同的斷言庫。</li>
      <li><strong>toBe</strong>: 比較兩物件是否有相同的值，常用來比較數值。</li>
      <li>…其實還有超多種斷言，有興趣可以上官網查。</li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>白話文就是： <code class="highlighter-rouge">expect(&lt;裡面回傳的結果&gt;).toBe(&lt;應該要跟這裡相等&gt;);</code></p>
</blockquote>

<h3 id="測試結果">測試結果</h3>

<p><img src="https://i.imgur.com/Cqn7tgL.jpg" alt="螢幕快照 2019-04-29 下午4.06.21" /></p>

<p>參考資料：</p>
<ul>
  <li><a href="https://github.com/Hsueh-Jen/blog/issues/1">用jest+enzyme來寫Reactjs的單元測試吧！</a> ( 寫得好清楚！ )</li>
  <li><a href="https://medium.com/enjoy-life-enjoy-coding/讓-jest-為你的-code-做單元測試-基礎用法教學-d898f11d9a23">讓 Jest 為你的 Code 做測試-基礎用法教學</a></li>
</ul>

<hr />

<h2 id="tdd-測試驅動開發">TDD 測試驅動開發</h2>

<p>全名為 Test-Driven-Development，是一種<strong>開發流程</strong>，指的是<strong>在實作功能之前，先寫測試程式。</strong></p>

<p>這樣有以下好處：</p>
<ul>
  <li>當開發者當寫出測試時，就可以瞭解這一個元件最後會怎麼使用，同時也釐清的程式的介面會如何定義。</li>
  <li>因為是先寫測試，所以也不會有趕時間上線，而忘了寫測試的情況</li>
  <li>每次實作功能時，只需要剛剛好通過一個新測試即可，不多也不少，不會過度設計</li>
</ul>

<p>看到 <a href="https://dotblogs.com.tw/hatelove/2017/06/01/the-test-word-real-meaning-of-tdd">[隨筆] 開發人員對 TDD 的心魔</a> 裡的一段話，讓我對 TDD 有更清楚的了解、何謂測試不止於測試，以下我直接引用原文：</p>

<hr />
<h4 id="測試不是測試">測試不是測試？</h4>

<ul>
  <li>如果是先有需求規格再寫 production code 呢？</li>
  <li>如果是為了先想好自己的目的跟驗證方式，再寫 production code 呢？</li>
  <li>如果是先想清楚，使用者、使用端到底要怎麼用我接下來提供的功能或產品，才會比較好用？</li>
</ul>

<p>這一些都不是「測試」（CHECKING）在做的事，反而比較像是<strong>需求描述、目標捕捉、建立邊界、迭代演進</strong>，只把力氣精準地花在目標上而不浪費。我們只是「恰巧」用了模樣長得像是「測試程式」的方式來進行上面這幾件事罷了。</p>

<hr />

<p>參考資料：</p>
<ul>
  <li><a href="https://tw.alphacamp.co/blog/2015-03-02-tdd-kata">程式設計師升級必練內功：TDD Kata</a></li>
  <li><a href="https://medium.com/@yurenju/自動軟體測試-tdd-與-bdd-464519672ac5">自動軟體測試、TDD 與 BDD</a></li>
  <li><a href="https://dotblogs.com.tw/hatelove/2017/06/01/the-test-word-real-meaning-of-tdd">[隨筆] 開發人員對 TDD 的心魔</a></li>
</ul>


<span class="post-date">
  Written on
  
  April
  29th,
  2019
  by Yakim shu
</span>
<div class="post-date">Feel free to share!</div>
  <div class="sharing-icons">
    <a href="https://twitter.com/intent/tweet?text=[第三週] JavaScript - 測試、Jest、TDD&amp;url=/project/project_w3_Javasciprt_jest.html&amp;via=" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=/project/project_w3_Javasciprt_jest.html&amp;title=[第三週] JavaScript - 測試、Jest、TDD" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
    <a href="https://plus.google.com/share?url=/project/project_w3_Javasciprt_jest.html" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
  </div>
</div>


<div class="related">
  <h1 >You may also enjoy:</h1>
  
  <ul class="related-posts">
    
      
        
          <li>
            <h3>
              <a href="/project/project_w3_Javasciprt_ES6.html">
                [第三週] JavaScript - ES6 語法、Babel 轉譯器
                <!--<img src="http://localhost:4000/images/">-->
                <!--<small>May 1, 2019</small>-->
              </a>
            </h3>
          </li>
          
        
      
        
          <li>
            <h3>
              <a href="/project/project_w3_Javasciprt_npm.html">
                [第三週] JavaScript - npm 套件管理工具
                <!--<img src="http://localhost:4000/images/">-->
                <!--<small>April 29, 2019</small>-->
              </a>
            </h3>
          </li>
          
        
      
        
        
      
    
      
        
        
      
    
      
        
        
      
    
      
        
        
      
    
  </ul>
</div>


<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://yakimshu.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<script id="dsq-count-scr" src="//yakimshu.disqus.com/count.js" async></script>

    </div>

    <footer class="footer">
  <a href="https://www.facebook.com/yakimshu"><i class="fa fa-facebook" aria-hidden="true" target="_blank"></i></a>
  <a href="https://linkedin.com/in/yakimshu"><i class="fa fa-linkedin" aria-hidden="true" target="_blank"></i></a>
  <a href="mailto:toromilk80129@gmail.com"><i class="fa fa-envelope" aria-hidden="true" target="_blank"></i></a>
  <div class="post-date"><a href="/about.html">Yakim shu | Hi, 這是我擴充腦內海馬體的地方。 by Yakim shu</a></div>
</footer>


  </div>

</body>
</html>
